{
    "contents" : "library(tseries)\nlibrary(timeDate)\nlibrary(timeSeries)\nlibrary(fBasics)\nlibrary(zoo)\nlibrary(fUnitRoots)\n\n#Import and Head Dataset\nmyd=read.table(\"touristDataTransClean.csv\",header=T, sep=',') \nhead(myd)\n\n#Extract Time Data(Year,Month,Count)\nTimeData = myd[,5:7]\n\ncounts = table(myd$Year)\nbarplot(counts, main=\"Bar Chart\",xlab=\"Number of Count by Year\")\n\n#Convert into Dataframe\ndataframe = as.data.frame(TimeData)\nhead(dataframe,10)\n\n#Agregatte Count by Year-Month\nlibrary(plyr)\nTS=ddply(dataframe, .(Year, Month), numcolwise(sum))\nhead(TS)\n\n#Original Count Distribution\n#Histogram of Count\npar(mfcol=c(1,1)) \nhist(TS$Count, xlab=\"Tourist Count\", main=\"Histogram for Whole Dataset\", freq = F)\nxfit<-seq(min(TS$Count),max(TS$Count),length=40)\nyfit<-dnorm(xfit,mean=mean(TS$Count),sd=sd(TS$Count))\nlines(xfit, yfit, col=\"blue\", lwd=2) \n#QQ-plot for Count\nqqnorm(TS$Count)\nqqline(TS$Count, col = 2)\n#Normality Test for Count\nnormalTest(TS$Count,method=c(\"jb\"))\n#Fat-tail Test for Whole Dataset\nk_stat = kurtosis(TS$Count)/sqrt(24/length(TS$Count))\nk_stat\nKurtosis_P_Value=2*(1-pnorm(abs(k_stat)))\nKurtosis_P_Value\n#Skewness Test for Whole Dataset\nskew_test = skewness(TS$Count)/sqrt(6/length(TS$Count))\nskew_test\nSkewness_test_P_Value=2*(1-pnorm(abs(skew_test)))\nSkewness_test_P_Value\n\n#Create Time Plot with Original Count\ntscount_raw = ts((TS$Count), start=c(1989,1), freq=12)\nplot(tscount_raw, main=\"Time plot of Whole Dataset\")\n\n#Transfrom Count into Log10(Count)\nLog_10_Count = log10(TS$Count)\n\n#Create Time Plot for Log10(Count)\ntscount_log = ts(Log_10_Count, start=c(1989,1), freq=12)\nplot(tscount_log, main=\"Time plot of Whole Dataset for Log10(Count)\",col=4)\n\n#Box-plot on for Time Series Count by month,to validate seasonality\nlibrary(ggplot2)\np <- ggplot(TS, aes(factor(TS$Month), log10(TS$Count)))\np + geom_boxplot() + ggtitle(\"Box-plot for Log10(Count) by Month\") + \n  theme(plot.title = element_text(size = 35,hjust=0.5,face = 'bold'), axis.title = element_text(size = 20,hjust=0.5,face = 'bold'),axis.text.x = element_text(size=20),axis.text.y = element_text(size=20))\n\n#ACF & PACF Plot\nacf(Log_10_Count,lag.max=100)\npacf(Log_10_Count,lag.max=100)\n\n#First Difference\ndx=diff(Log_10_Count)\nacf(as.vector(dx),lag.max=100, main=\"ACF of First Difference\")\npacf(dx,lag=100, main=\"PACF of First Difference\")\n\n#Seasonnality\nsdx=diff(dx,12)\nacf(as.vector(sdx),lag.max=100, main=\"ACF of Seasonal Difference\")\npacf(sdx,lag=100,main=\"PACF of Seasonal Difference\")\n\n#Dickey Fuller Test\nadfTest(Log_10_Count, lags=4, type=c(\"c\"))\nadfTest(Log_10_Count, lags=8, type=c(\"c\"))\nadfTest(Log_10_Count, lags=12, type=c(\"c\"))\n\n#Fitting the Model\nlibrary(forecast)\nm0=auto.arima(Log_10_Count,ic=\"bic\",trace=T,stationary=F,seasonal=TRUE)\nlibrary(lmtest)\ncoeftest(m0)\n#Residual Analysis for ARIMA(1,1,1) with drift\nacf(m0$residuals,lag.max = 100,main=\"ACF Plot for ARIMA(1,1,2) Residuals\")\npacf(m0$residuals,lag.max = 100,main=\"PACF Plot for ARIMA(1,1,2) Residuals\")\n#Box test for White Noise\nBox.test(m0$residuals, 6, \"Ljung-Box\", fitdf=2)\nBox.test(m0$residuals, 12, \"Ljung-Box\", fitdf=2)\n\n#Add seasonal part to ARIMA(1,1,2)\nm1=arima(Log_10_Count, order=c(1,1,2),seasonal=list(order=c(0,1,1),period=12), method=\"ML\")\ncoeftest(m1)\nacf(m1$residuals,lag.max = 100,main=\"ACF Plot for SARIMA(1,1,2)(0,1,1)[12] Residuals\")\npacf(m1$residuals,lag.max = 100,main=\"PACF Plot for SARIMA(1,1,2)(0,1,1)[12] Residuals\")\nBox.test(m1$residuals, 6, \"Ljung-Box\", fitdf=3)\nBox.test(m1$residuals, 12, \"Ljung-Box\", fitdf=3)\nqqnorm(m1$resid)\nqqline(m1$resid)\n\n#Manually find a new model\nm2=arima(Log_10_Count, order=c(2,1,4),seasonal=list(order=c(0,1,1),period=12), method=\"ML\")\ncoeftest(m2)\nacf(m2$residuals,lag.max = 100,main=\"ACF Plot for SARIMA(2,1,4)(0,1,1)[12] Residuals\")\npacf(m2$residuals,lag.max = 100,main=\"PACF Plot for SARIMA(2,1,4)(0,1,1)[12] Residuals\")\nBox.test(m2$residuals, 9, \"Ljung-Box\", fitdf=6)\nBox.test(m2$residuals, 15, \"Ljung-Box\", fitdf=6)\nqqnorm(m2$resid)\nqqline(m2$resid)\n\n#Back-tDest\nsource(\"backtest.r\")\nbacktest(m2,Log_10_Count,h=1,orig=324*0.9)\n\n#Forecasting\nf1=forecast.Arima(m2,h=60)\nf1\nf1$mean=10**(f1$mean)\nf1$upper=10**(f1$upper)\nf1$lower=10**(f1$lower)\nf1$x=10**(f1$x)\nf1$fitted = 10**(f1$fitted)\nf1$fitted\nf1\nplot(f1,main=\"5-step Ahead Forecast with SARIMA(2,1,4)(0,1,1)[12]\")\nlines(fitted(f1),col=\"red\")\n\n\n#Air Way-in Analysis\n#Extract Air Way-in subset\nnewdata=myd[which(myd$WayIn=='Air'),]\nhead(newdata)\nsummary(newdata$WayIn)\nsummary(newdata)\n\n#Extract Time Data(Year,Month,Count)\nTimeData = newdata[,5:7]\n\ncounts = table(newdata$Year)\nbarplot(counts, main=\"Bar Chart\",xlab=\"Number of Count by Year\")\n\n#Convert into Dataframe\ndataframe = as.data.frame(TimeData)\nhead(dataframe,10)\n\n#Agregatte Count by Year-Month\nlibrary(plyr)\nTS=ddply(dataframe, .(Year, Month), numcolwise(sum))\nhead(TS)\n\n#Histogram of Count\npar(mfcol=c(1,1)) \nhist(TS$Count, xlab=\"Tourist Count\", main=\"Histogram for Air Way-in Count\", freq = F)\nxfit<-seq(min(TS$Count),max(TS$Count),length=40)\nyfit<-dnorm(xfit,mean=mean(TS$Count),sd=sd(TS$Count))\nlines(xfit, yfit, col=\"blue\", lwd=2) \n#QQ-plot for Count\nqqnorm(TS$Count)\nqqline(TS$Count, col = 2)\n#Normality Test for Air Way-in Count\nnormalTest(TS$Count,method=c(\"jb\"))\n#Fat-tail Test for Air Way-in Count\nk_stat = kurtosis(TS$Count)/sqrt(24/length(TS$Count))\nk_stat\nKurtosis_P_Value=2*(1-pnorm(abs(k_stat)))\nKurtosis_P_Value\n#Skewness Test for Air Way-in Count\nskew_test = skewness(TS$Count)/sqrt(6/length(TS$Count))\nskew_test\nSkewness_test_P_Value=2*(1-pnorm(abs(skew_test)))\nSkewness_test_P_Value\n\n#Create Time Plot for Air Way-in Count\ntscount_raw = ts((TS$Count), start=c(1989,1), freq=12)\nplot(tscount_raw, main=\"Time plot of Air Way-in Count\")\n\n#Transfrom Count into Log10(Count)\nLog_10_Count = log10(TS$Count)\n\n#Create Time Plot for Log10(Count)\ntscount_log = ts(Log_10_Count, start=c(1989,1), freq=12)\nplot(tscount_log, main=\"Time plot of Air Way-in Log10(Count)\",col='blue')\n\n#Box-plot on for Time Series Count by Year\nlibrary(ggplot2)\np <- ggplot(TS, aes(factor(TS$Month), log10(TS$Count)))\np + geom_boxplot()\n\npar(mfcol=c(4,1)) \n#ACF & PACF Plot\nacf(Log_10_Count,lag.max=100,main=\"ACF Plot for Air Way-in Log10(Count)\")\npacf(Log_10_Count,lag.max=100,main=\"PACF Plot for Air Way-in Log10(Count)\")\n\n#First Difference\ndx=diff(Log_10_Count)\nacf(as.vector(dx),lag.max=100, main=\"ACF of Log(Air-in) First Difference\")\npacf(dx,lag=100,main=\"PACF of Log(Air-in) First Difference\")\n\n#Seasonnality\nsdx=diff(dx,12)\nacf(as.vector(sdx),lag.max=100, main=\"ACF of Log(Air Way-in) Seasonal Difference\")\npacf(sdx,lag=100,main=\"PACF of Log(Air Way-in) Seasonal Difference\")\n\n#Dickey Fuller Test\nadfTest(Log_10_Count, lags=4, type=c(\"c\"))\nadfTest(Log_10_Count, lags=8, type=c(\"c\"))\nadfTest(Log_10_Count, lags=12, type=c(\"c\"))\n\n#Fitting the Model\nlibrary(forecast)\nm0=auto.arima(Log_10_Count,ic=\"bic\",trace=T,stationary=F,seasonal=TRUE)\nlibrary(lmtest)\ncoeftest(m0)\n#Residual Analysis for m0=ARIMA(1,1,1) with drift\nacf(m0$residuals,lag.max = 100,main=\"ACF Plot of Air-ARIMA(1,1,1) Residuals\")\npacf(m0$residuals,lag.max = 100,main=\"PACF Plot of Air-ARIMA(1,1,1) Residuals\")\n#Box test for White Noise\nBox.test(m0$residuals, 6, \"Ljung-Box\", fitdf=2)\nBox.test(m0$residuals, 12, \"Ljung-Box\", fitdf=2)\n\n#Manually find a new model\nm1=arima(Log_10_Count, order=c(2,1,3),seasonal=list(order=c(0,1,1),period=12), method=\"ML\")\ncoeftest(m1)\n#Remove insignificantly parameters\nm1=arima(Log_10_Count, order=c(2,1,3),seasonal=list(order=c(0,1,1),period=12), method=\"ML\", fixed=c(0,NA,NA,NA,NA,NA))\ncoeftest(m1)\nacf(m1$residuals,lag.max = 100,main=\"ACF Plot of Air-SARIMA(2,1,3)(0,1,1)[12] Residuals\")\npacf(m1$residuals,lag.max = 100,main=\"PACF Plot of Air-SARIMA(2,1,3)(0,1,1)[12] Residuals\")\nBox.test(m1$residuals, 9, \"Ljung-Box\", fitdf=5)\nBox.test(m1$residuals, 12, \"Ljung-Box\", fitdf=5)\nqqnorm(m1$resid)\nqqline(m1$resid)\n\n#Back-test\nsource(\"backtest.r\")\nbacktest(m1,Log_10_Count,h=1,orig=324*0.9)\n\n#Forecasting\nf1=forecast.Arima(m1,h=60)\nf1\nf1$mean=10**(f1$mean)\nf1$upper=10**(f1$upper)\nf1$lower=10**(f1$lower)\nf1$x=10**(f1$x)\nf1$fitted = 10**(f1$fitted)\nf1\nplot(f1,main=\"5-step Ahead Forecast for Air Way-in SARIMA(2,1,3)(0,1,1)[12]\")\nlines(fitted(f1),col=\"red\")\n\n\n#Land Way-in Analysis\n#Extract Land Way-in subset\nLanddata=subset(myd,myd$WayIn=='Land')\nland=Landdata[,5:7]\nhead(land)\n#Convert into Dataframe\nlandframe = as.data.frame(land)\nhead(landframe,10)\n\n#Agregatte Count by Year-Month\nLTS=ddply(landframe, .(Year, Month), numcolwise(sum))\nhead(LTS)\n\n#Data distribution\n#Histogram \nhist(LTS$Count, xlab=\"Tourist Count\", main=\"Histogram for Land Way-in Count\", freq = F)\nxfit<-seq(min(LTS$Count),max(LTS$Count),length=40)\nyfit<-dnorm(xfit,mean=mean(LTS$Count),sd=sd(LTS$Count))\nlines(xfit, yfit, col=\"blue\", lwd=2) \n#QQ-plot \nqqnorm(LTS$Count)\nqqline(LTS$Count, col = 2)\n#Normality Test for Land Way-in Count\nnormalTest(LTS$Count,method=c(\"jb\"))\n#Fat-tail Test for Land Way-in Count\nk_stat = kurtosis(LTS$Count)/sqrt(24/length(LTS$Count))\nk_stat\nKurtosis_P_Value=2*(1-pnorm(abs(k_stat)))\nKurtosis_P_Value\n#Skewness Test for Land Way-in Count\nskew_test = skewness(LTS$Count)/sqrt(6/length(LTS$Count))\nskew_test\nSkewness_test_P_Value=2*(1-pnorm(abs(skew_test)))\nSkewness_test_P_Value\n\n#Create Time Plot\ntslandcount= ts((LTS$Count), start=c(1989,1), freq=12)\nplot(tslandcount, main=\"Time plot of Land Way-in\")\n\n#Create Time Plot with Log10(LandCount)\nLog_10_LCount = log10(LTS$Count)\ntslcount_log = ts(Log_10_LCount, start=c(1989,1), freq=12)\nplot(tslcount_log, main=\"Time plot of Log Land Way-in\",col=\"blue\")\n\n\n#Box-plot on for Time Series Count by month,to validate seasonality\np =ggplot(LTS, aes(factor(LTS$Month), log10(LTS$Count)))\np + geom_boxplot()\n\n#ACF Plot\nacf(Log_10_LCount,lag.max=100,main=\"ACF Plot for Log Land Way-in\")\npacf(Log_10_LCount,lag.max=100,main=\"PACF Plot for Log Land Way-in\")\npar(mfcol=c(4,1)) \ndx=diff(Log_10_LCount)\nacf(as.vector(dx),lag.max=100, main=\"ACF of Log Land Way-in First Difference\")\npacf(dx,lag=100,main=\"PACF of Log Land Way-in First Difference\")\nsdx=diff(dx,12)\nacf(as.vector(sdx),lag.max=100, main=\"ACF of Log Land Way-in Seasonal Difference\")\npacf(sdx,lag=100,main=\"PACF of Log Land Way-in Seasonal Difference\")\n\n#Dickey Fuller Test\nadfTest(Log_10_Count, lags=4, type=c(\"c\"))\nadfTest(Log_10_Count, lags=8, type=c(\"c\"))\nadfTest(Log_10_Count, lags=12, type=c(\"c\"))\n\n#fit model\nm0=auto.arima(Log_10_LCount,ic=\"bic\",allowdrift = T,trace=T,stationary=F,seasonal=T)\ncoeftest(m0)\nacf(m0$residuals,lag.max = 100,main=\"ACF Plot for Land ARIMA(1,1,2) Residuals\")\n#Add seasonal part to m0\nm1=arima(Log_10_LCount, order=c(1,1,2),seasonal=list(order=c(0,1,1),period=12), method=\"ML\")\ncoeftest(m1)\nacf(m1$residuals,lag.max = 100,main=\"ACF Plot for SARIMA(1,1,2)(0,1,1)[12] Residuals\")\npacf(m1$residuals,lag.max = 100,main=\"PACF Plot for SARIMA(1,1,2)(0,1,1)[12] Residuals\")\nBox.test(m1$residuals, 6, \"Ljung-Box\", fitdf=3)\nBox.test(m1$residuals, 12, \"Ljung-Box\", fitdf=3)\n#Manually find a new model\nm2=arima(Log_10_LCount, order=c(1,1,4),seasonal=list(order=c(0,1,1),period=12), method=\"ML\")\ncoeftest(m2)\n#Remove insignificant parameters from previous model\nm2=arima(Log_10_LCount, order=c(1,1,4),seasonal=list(order=c(0,1,1),period=12), method=\"ML\",fixed=c(NA,0,NA,0,0,NA))\ncoeftest(m2)\nacf(m2$residuals,lag.max = 100,main=\"ACF Plot for SARIMA(1,1,4)(0,1,1)[12] Residuals\")\npacf(m2$residuals,lag.max = 100,main=\"PACF Plot for SARIMA(1,1,4)(0,1,1)[12] Residuals\")\nBox.test(m2$residuals, 10, \"Ljung-Box\", fitdf=5)\nBox.test(m2$residuals, 14, \"Ljung-Box\", fitdf=5)\nqqnorm(m2$resid)\nqqline(m2$resid)\n#Best Model!!!\nm3=arima(Log_10_LCount, order=c(2,1,4),seasonal=list(order=c(0,1,1),period=12), method=\"ML\")\ncoeftest(m3)\nm3=arima(Log_10_LCount, order=c(2,1,4),seasonal=list(order=c(0,1,1),period=12), method=\"ML\",fixed=c(NA,NA,NA,NA,0,NA,NA))\ncoeftest(m3)\nacf(m3$residuals,lag.max = 100,main=\"ACF Plot for SARIMA(2,1,4)(0,1,1)[12] Residuals\")\npacf(m3$residuals,lag.max = 100,main=\"PACF Plot for SARIMA(1,1,4)(0,1,1)[12] Residuals\")\nBox.test(m3$residuals, 10, \"Ljung-Box\", fitdf=6)\nBox.test(m3$residuals, 14, \"Ljung-Box\", fitdf=6)\nqqnorm(m3$resid)\nqqline(m3$resid)\n\n#backtest\nsource(\"backtest.r\")\nbacktest(m3,Log_10_Count,h=1,orig=324*0.9)\n#forecast\nf1=forecast.Arima(m3,h=60)\nf1$mean=10**(f1$mean)\nf1$upper=10**(f1$upper)\nf1$lower=10**(f1$lower)\nf1$x=10**(f1$x)\nf1$fitted = 10**(f1$fitted)\nf1$x\npar(mfcol=c(1,1)) \nplot(f1,main=\"5-step Ahead Forecast for Land Way-in SARIMA(2,1,4)(0,1,1)[12]\")\nlines(fitted(f1),col=\"red\")\n",
    "created" : 1520048739191.000,
    "dirty" : false,
    "encoding" : "ISO8859-1",
    "folds" : "",
    "hash" : "3338910441",
    "id" : "71A26DB3",
    "lastKnownWriteTime" : 1489538274,
    "path" : "E:/courses/CSC425 Time series analysis forecasting/project/Brizal Tourists Data Final code.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}